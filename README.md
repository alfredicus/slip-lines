# 3D Slip Lines & Equipotentials Visualization

A modern React/TypeScript component using Three.js for visualizing theoretical slip lines, equipotential curves, and principal stress axes on a 3D sphere. Converted from the original Python implementation.

## Features

- **3D Interactive Visualization**: Rotate, zoom, and inspect the stress field
- **Equipotential Curves**: Visualize equipotential surfaces from the stress tensor
- **Slip Lines**: Generate and display theoretical slip lines in 3D
- **Principal Stress Axes**: Show the three principal stress directions with colored arrows
- **Real-time Parameter Adjustment**: Dynamically adjust stress tensor components (σ_x, σ_y, σ_z)
- **Color Customization**: Change colors for slip lines and equipotentials
- **Responsive Design**: Works on different screen sizes with side panel controls

## Installation

### Prerequisites
- Node.js >= 14
- npm or yarn

### Setup

1. Clone or download the project files
2. Navigate to the project directory
3. Install dependencies:

```bash
npm install
# or
yarn install
```

## Usage

### Development

Run the development server:

```bash
npm run dev
# or
yarn dev
```

Open your browser to `http://localhost:5173` (or the URL shown in terminal)

### Build for Production

```bash
npm run build
# or
yarn build
```

The built files will be in the `dist/` directory.

### TypeScript Type Checking

```bash
npm run type-check
```

## File Structure

- **SlipLinesVisualization.tsx** - Main TypeScript/React component (recommended for production)
- **SlipLinesVisualization.jsx** - JavaScript version (alternative)
- **package.json** - Project dependencies and scripts

## Component Usage

### As a React Component

```tsx
import SlipLinesVisualization from './SlipLinesVisualization';

export default function App() {
  return <SlipLinesVisualization />;
}
```

### Props (if needed in future)

Currently, the component uses internal state. To make it configurable, you can modify to accept props:

```tsx
interface Props {
  initialSigmaX?: number;
  initialSigmaY?: number;
  initialSigmaZ?: number;
}

const SlipLinesVisualization: React.FC<Props> = ({
  initialSigmaX = 1.0,
  initialSigmaY = 3.0,
  initialSigmaZ = 2.0
}) => {
  // ...
}
```

## Controls

### Mouse Interactions
- **Drag**: Rotate the view
- **Scroll**: Zoom in/out

### GUI Controls
- **Stress Tensor Parameters**: Adjust σ_x, σ_y, σ_z using sliders (-5 to +5)
- **Show/Hide Equipotentials**: Toggle equipotential curves visibility
- **Equipotential Color**: Choose color for equipotential curves
- **Show/Hide Slip Lines**: Toggle slip lines visibility
- **Slip Line Color**: Choose color for slip lines
- **Show/Hide Stress Axes**: Toggle principal stress axes visibility

## Stress Tensor Conventions

The component uses the following stress tensor conventions:
- **σ_x (σ₁)**: Minimum principal stress (most compressive)
- **σ_y (σ₃)**: Maximum principal stress (most extensional)
- **σ_z (σ₂)**: Intermediate principal stress

### Example Configurations

**Uniaxial Compression** (σ_x = 1, σ_y = 0, σ_z = 0)
- Simple vertical compression

**Triaxial Stress** (σ_x = 1, σ_y = 3, σ_z = 2)
- All three stresses different
- General stress state

**Hydrostatic Stress** (σ_x = 1, σ_y = 1, σ_z = 1)
- Equal stresses in all directions

## Algorithms

### Equipotential Curves
Equipotentials are generated by:
1. Dividing stress range into N levels
2. For each level, marching around azimuth (φ) from 0 to 2π
3. Using binary search to find polar angle (θ) where stress equals the target level
4. Rendering as connected 3D curves

### Slip Lines
Slip lines are generated by:
1. Dividing the sphere into quadrants
2. Creating N curves per quadrant with different starting azimuths
3. Applying stress-dependent modulation to create realistic slip line patterns
4. Rendering as 3D curves at high resolution

### Principal Stress Axes
Principal axes are determined by:
1. Sorting stress components by magnitude
2. Assigning colors: Red (σ₁), Green (σ₂), Blue (σ₃)
3. Drawing vectors from origin through the stress directions
4. Adding arrow heads to indicate direction

## Three.js Components

- **Scene**: Container for all 3D objects
- **Sphere Mesh**: Semi-transparent sphere surface (α = 0.3)
- **Lines**: THREE.Line for equipotentials and slip lines
- **LineSegments**: For principal axes and arrow heads
- **Lighting**: Ambient + Directional light for proper shading
- **Axes Helper**: Reference frame (RGB for XYZ)

## Customization

### Changing Curve Resolution
Modify `curveResolution` variable in the component:
```tsx
const curveResolution = 200; // Higher = smoother but slower
```

### Changing Number of Curves
Modify `nCurves` and `nIsoCurves`:
```tsx
const nCurves = 12;      // Slip lines per quadrant
const nIsoCurves = 8;    // Equipotential levels
```

### Modifying Sphere Appearance
Edit the sphere material in `useEffect`:
```tsx
const sphereMaterial = new THREE.MeshPhongMaterial({
  color: 0xe8e8e8,        // Change color
  opacity: 0.3,           // Change transparency
  wireframe: false        // Enable for wireframe mode
});
```

### Adding More Features

To add additional visualization features:
1. Create a new `generate*` function (e.g., `generatePrincipalCircles`)
2. Add a state variable for showing/hiding it
3. Add checkbox in GUI
4. Call the function and add to scene in the `useEffect` hook

## Performance Considerations

- **Curve Resolution**: Default 200 points per curve provides good balance
- **Number of Curves**: 12 slip lines × 4 quadrants = 48 curves maximum
- **WebGL Limits**: Three.js can handle ~1000 lines smoothly
- **Device Performance**: Higher resolution curves may affect mobile performance

## Browser Compatibility

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- Requires WebGL support

## Troubleshooting

### Component Not Rendering
1. Ensure container div has non-zero dimensions
2. Check console for WebGL errors
3. Verify Three.js is installed: `npm ls three`

### Performance Issues
1. Reduce `curveResolution`
2. Reduce `nCurves` and `nIsoCurves`
3. Disable stress axes if not needed

### Colors Not Showing
1. Verify color strings are valid hex format (e.g., '#D62728')
2. Check material transparency settings
3. Ensure lighting is adequate

## Future Enhancements

- Export to various formats (PNG, STL, glTF)
- Multiple color modes (by stress type, by property)
- Animation of stress evolution over time
- Stereographic projection view
- Data import/export
- Measurements and annotations
- VR support via WebXR

## References

Based on the theoretical framework from:
- Taboada, A., 1993, *Stress and strain from striated pebbles*. Journal of Structural Geology, 15(11).

## License

Same license as the original Python implementation.

## Conversion Notes

### From Python to TypeScript/React

**Key Changes:**
1. Replaced matplotlib 3D with Three.js
2. Replaced tkinter GUI with React components
3. Converted NumPy operations to JavaScript/TypeScript
4. Simplified curve generation algorithm for performance
5. Added type safety with TypeScript interfaces

**Maintained Features:**
- Stress tensor parameterization
- Equipotential and slip line generation
- Principal stress axes visualization
- Interactive controls and real-time updates
- Color customization

**Simplified:**
- Removed DEM data support (can be re-added)
- Removed striation field visualization
- Removed trajectory curves
- Removed color mapping modes (can be extended)

## Questions?

For issues or questions about the original Python implementation:
- See the docstring in `3D_slip_lines_and_striations_2f.py`
- Consult the structural geology references

For React/Three.js implementation questions:
- Check Three.js documentation: https://threejs.org
- React hooks reference: https://react.dev
